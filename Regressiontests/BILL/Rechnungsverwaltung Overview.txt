*** Settings ***
Documentation     Menüpunktes BILL -> Rechnungsverwaltung: Rechnungsübersicht
Suite Setup       Select Rechnungsverwaltung    true
Suite Teardown    Close Browser
Force Tags        Bill    Rechnungsverwaltung
Default Tags
Resource          ../../UserKeywords/Common_Resources.html
Resource          ../../UserKeywords/BILL_Resources.html
Resource          PageObjects/Rechnungsverwaltung_Overview.txt
Resource          PageObjects/Menu.txt
Library           ../../Libs/ActionChainsExtension.py
Variables         PageObjects/Rechnungsverwaltung_Overview.yaml

*** Test Cases ***
Select no Bill
    [Documentation]    BILL -> Rechnungsverwaltung -> Übersicht: Status der Buttons, wenn kein Element selektiert ist
    [Tags]    BillSelection
    Element Should Be Enabled    ${chkShowClosedBills}
    Element Should Be Enabled    ${chkShowProcessedBills}
    Element Should Be Enabled    ${chkShowProformaBills}
    Element Should Be Enabled    ${btnCreateBill}
    Element Should Be Enabled    ${btnAbort}
    Element Should Be Disabled    ${btnRecalculate}
    Element Should Be Disabled    ${btnEditBill}
    Element Should Be Disabled    ${btnDeleteBill}
    Element Should Be Disabled    ${btnReopenBill}
    Element Should Be Disabled    ${btnCloseBill}
    Element Should Be Disabled    ${btnProcessBill}
    Element Should Be Disabled    ${btnExportBills}

Select Bill in Status "In Bearbeitung"
    [Documentation]    BILL -> Rechnungsverwaltung -> Übersicht: Status der Buttons, wenn Rechnung selektiert ist im Status "In Bearbeitung"
    [Tags]    BillSelection
    Click Element    ${invOpen}
    Status of Bill Should Be    ${invOpen}    In Bearbeitung
    Element Should Be Enabled    ${chkShowClosedBills}
    Element Should Be Enabled    ${chkShowProcessedBills}
    Element Should Be Enabled    ${chkShowProformaBills}
    Element Should Be Enabled    ${btnCreateBill}
    Element Should Be Enabled    ${btnAbort}
    Element Should Be Enabled    ${btnRecalculate}
    Element Should Be Enabled    ${btnEditBill}
    Element Should Be Enabled    ${btnDeleteBill}
    Element Should Be Disabled    ${btnReopenBill}
    Element Should Be Enabled    ${btnCloseBill}
    Element Should Be Enabled    ${btnProcessBill}
    Element Should Be Enabled    ${btnExportBills}

Select Bill in Status "Verarbeitet"
    [Documentation]    BILL -> Rechnungsverwaltung -> Übersicht: Status der Buttons, wenn Rechnung selektiert ist im Status "Verarbeitet"
    [Tags]    BillSelection
    Click Element    ${invProcessed}
    Status of Bill Should Be    ${invProcessed}    Verarbeitet
    Element Should Be Enabled    ${chkShowClosedBills}
    Element Should Be Enabled    ${chkShowProcessedBills}
    Element Should Be Enabled    ${chkShowProformaBills}
    Element Should Be Enabled    ${btnCreateBill}
    Element Should Be Enabled    ${btnAbort}
    Element Should Be Disabled    ${btnRecalculate}
    Element Should Be Enabled    ${btnEditBill}
    Element Should Be Enabled    ${btnDeleteBill}
    Element Should Be Disabled    ${btnReopenBill}
    Element Should Be Disabled    ${btnCloseBill}
    Element Should Be Disabled    ${btnProcessBill}
    Element Should Be Enabled    ${btnExportBills}

Select Bill in Status "Verarbeitet & veröffentlicht"
    [Documentation]    BILL -> Rechnungsverwaltung -> Übersicht: Status der Buttons, wenn Rechnung selektiert ist im Status "Verarbeitet"
    [Tags]    BillSelection
    Click Element    ${invProcessedClosed}
    Status of Bill Should Be    ${invProcessedClosed}    Verarbeitet & veröffentlicht
    Element Should Be Enabled    ${chkShowClosedBills}
    Element Should Be Enabled    ${chkShowProcessedBills}
    Element Should Be Enabled    ${chkShowProformaBills}
    Element Should Be Enabled    ${btnCreateBill}
    Element Should Be Enabled    ${btnAbort}
    Element Should Be Disabled    ${btnRecalculate}
    Element Should Be Enabled    ${btnEditBill}
    Element Should Be Enabled    ${btnDeleteBill}
    Element Should Be Disabled    ${btnReopenBill}
    Element Should Be Disabled    ${btnCloseBill}
    Element Should Be Disabled    ${btnProcessBill}
    Element Should Be Enabled    ${btnExportBills}

Select Bill in Status "Veröffentlicht"
    [Documentation]    BILL -> Rechnungsverwaltung -> Übersicht: Status der Buttons, wenn Rechnung selektiert ist im Status "Veröffentlicht"
    [Tags]    BillSelection
    Click Element    ${invClosed}
    Status of Bill Should Be    ${invClosed}    Veröffentlicht
    Element Should Be Enabled    ${chkShowClosedBills}
    Element Should Be Enabled    ${chkShowProcessedBills}
    Element Should Be Enabled    ${chkShowProformaBills}
    Element Should Be Enabled    ${btnCreateBill}
    Element Should Be Enabled    ${btnAbort}
    Element Should Be Disabled    ${btnRecalculate}
    Element Should Be Enabled    ${btnEditBill}
    Element Should Be Enabled    ${btnDeleteBill}
    Element Should Be Enabled    ${btnReopenBill}
    Element Should Be Disabled    ${btnCloseBill}
    Element Should Be Enabled    ${btnProcessBill}
    Element Should Be Enabled    ${btnExportBills}

Select Multiple Bills
    [Documentation]    BILL -> Rechnungsverwaltung -> Übersicht: Status der Buttons, wenn mehrere Elemente selektiert sind
    [Tags]    BillSelection
    ${ids}    Create List    ${invProcessed}    ${invProcessedClosed}
    Select Elements With CONTROL    ${ids}
    Run Keyword And Continue On Failure    Bill Should Be Selected    ${invProcessed}
    Run Keyword And Continue On Failure    Bill Should Be Selected    ${invProcessedClosed}
    Select Elements With SHIFT    ${invProcessed}    ${invProcessedClosed}
    Bill Should Be Selected    ${invProcessed}
    Bill Should Be Selected    ${invProcessedClosed}
    Element Should Be Enabled    ${chkShowClosedBills}
    Element Should Be Enabled    ${chkShowProcessedBills}
    Element Should Be Enabled    ${chkShowProformaBills}
    Element Should Be Enabled    ${btnCreateBill}
    Element Should Be Enabled    ${btnAbort}
    Element Should Be Disabled    ${btnRecalculate}
    Element Should Be Disabled    ${btnEditBill}
    Element Should Be Disabled    ${btnDeleteBill}
    Element Should Be Disabled    ${btnReopenBill}
    Element Should Be Disabled    ${btnCloseBill}
    Element Should Be Disabled    ${btnProcessBill}
    Element Should Be Disabled    ${btnExportBills}

Check Languagedependent Text Content
    [Documentation]    Bill -> Rechnungsverwaltung -> Übersicht: Prüft, ob pro Sprache die richtigen Texte der (statischen) Modul-Dictionaries angezeigt werden
    [Tags]    Languagedependent
    Sleep    1
    Create SettingsDics    Bills    State_InProgress
    Create SettingsDics    Bills    State_IsProcessed
    Create SettingsDics    Bills    State_IsProcessed_and_Published
    : FOR    ${key}    IN    @{AVAILABLE_LANGUAGES.keys()}
    \    Set LanguageId    ${key}
    \    Sleep    1
    \    Check LanguageId is selected    ${key}
    \    ${language_code} =    Get Selected LanguageCode
    \    Run Keyword And Continue On Failure    Element Text Should Be    ${lblHeadline}    &{DicYAML_Rechnungsverwaltung}[${language_code}]
    \    Run Keyword And Continue On Failure    Element Text Should Be    ${colProforma}    &{DicYAML_Proforma}[${language_code}]
    \    Run Keyword And Continue On Failure    Element Text Should Be    ${colBillNo}    &{DicYAML_Rechnungs-Nr.}[${language_code}]
    \    Run Keyword And Continue On Failure    Element Text Should Be    ${colBillName}    &{DicYAML_Rechnungsbezeichnung}[${language_code}]
    \    Run Keyword And Continue On Failure    Element Text Should Be    ${colStatus}    &{DicYAML_Status}[${language_code}]
    \    Run Keyword And Continue On Failure    Element Text Should Be    ${colDateOfCreation}    &{DicYAML_Erstellt am}[${language_code}]
    \    Run Keyword And Continue On Failure    Element Text Should Be    ${colPositionCount}    &{DicYAML_Positionen}[${language_code}]
    \    Run Keyword And Continue On Failure    Check LabelText    ${chkShowClosedBills}    &{DicYAML_Auch bereits veröffentlichte Rechnungen mit anzeigen}[${language_code}]
    \    Run Keyword And Continue On Failure    Check LabelText    ${chkShowProcessedBills}    &{DicYAML_Auch bereits verarbeitete Rechnungen mit anzeigen}[${language_code}]
    \    Run Keyword And Continue On Failure    Check LabelText    ${chkShowProformaBills}    &{DicYAML_Auch Proformarechnungen mit anzeigen}[${language_code}]
    \    Run Keyword And Continue On Failure    Element Text Should Be    ${btnCreateBill}    &{DicYAML_Neue Rechnung eröffnen}[${language_code}]
    \    Run Keyword And Continue On Failure    Element Text Should Be    ${btnEditBill}    &{DicYAML_Rechnung bearbeiten}[${language_code}]
    \    Run Keyword And Continue On Failure    Element Text Should Be    ${btnDeleteBill}    &{DicYAML_Rechnung löschen}[${language_code}]
    \    Run Keyword And Continue On Failure    Element Text Should Be    ${btnReopenBill}    &{DicYAML_Rechnung zurückziehen}[${language_code}]
    \    Run Keyword And Continue On Failure    Element Text Should Be    ${btnCloseBill}    &{DicYAML_Rechnung veröffentlichen}[${language_code}]
    \    Run Keyword And Continue On Failure    Element Text Should Be    ${btnProcessBill}    &{DicYAML_Rechnung ist verarbeitet}[${language_code}]
    \    Run Keyword And Continue On Failure    Element Text Should Be    ${btnRecalculate}    &{DicYAML_Preise erneut berechnen}[${language_code}]
    \    Run Keyword And Continue On Failure    Element Text Should Be    ${btnAbort}    &{DicYAML_Vorgang abbrechen}[${language_code}]
    \    Run Keyword And Continue On Failure    Element Text Should Be    ${btnExportBills}    &{DicYAML_Rechnungsexport}[${language_code}]
    \    Run Keyword And Continue On Failure    Status of Bill Should Be    ${invClosed}    Veröffentlicht
    \    Sleep    1

Sort By Rechnungs-Nr
    [Documentation]    BILL -> Rechnungsverwaltung -> Übersicht: Sortierung nach Spalte "Rechnungs-Nr."
    [Tags]    Sorting
    Sleep    1
    Click Element    ${colBillNo}
    ${billNumbers} =    Get Elements Texts    ${grdBills}/div[contains(@class,'gridcontainer')]/table/tbody/tr/td[2]/div
    List Of Strings Should Be Ordered ASC    ${billNumbers}
    Click Element    ${colBillNo}
    ${billNumbers} =    Get Elements Texts    ${grdBills}/div[contains(@class,'gridcontainer')]/table/tbody/tr/td[2]/div
    List Of Strings Should Be Ordered DESC    ${billNumbers}

Sort By Rechnungsbezeichnung
    [Documentation]    BILL -> Rechnungsverwaltung -> Übersicht: Sortierung nach Spalte "Rechnungsbezeichnung"
    [Tags]    Sorting
    Sleep    1
    Click Element    ${colBillName}
    ${billNames} =    Get Elements Texts    ${grdBills}/div[contains(@class,'gridcontainer')]/table/tbody/tr/td[3]/div
    List Of Strings Should Be Ordered ASC    ${billNames}    ${TRUE}
    Click Element    ${colBillName}
    ${billNames} =    Get Elements Texts    ${grdBills}/div[contains(@class,'gridcontainer')]/table/tbody/tr/td[3]/div
    List Of Strings Should Be Ordered DESC    ${billNames}    ${TRUE}

Sort By Status
    [Documentation]    BILL -> Rechnungsverwaltung -> Übersicht: Sortierung nach Spalte "Status"
    [Tags]    Sorting
    Sleep    1
    Click Element    ${colStatus}
    ${billStatus} =    Get Elements Texts    ${grdBills}/div[contains(@class,'gridcontainer')]/table/tbody/tr/td[4]/div
    List Of Strings Should Be Ordered ASC    ${billStatus}
    Click Element    ${colStatus}
    ${billStatus} =    Get Elements Texts    ${grdBills}/div[contains(@class,'gridcontainer')]/table/tbody/tr/td[4]/div
    List Of Strings Should Be Ordered DESC    ${billStatus}
    # Check Sort By Erstellt am
    #    [Documentation]    BILL -> Rechnungsverwaltung -> Übersicht: Sortierung nach Spalte "Erstellt am"
    #    [Tags]    Sorting
    #    Sleep    1
    #    Click Element    ${colDateOfCreation}
    #    ${billStatus} =    Get Elements Texts    ${grdBills}/div[contains(@class,'gridcontainer')]/table/tbody/tr/td[5]/div
    #    List Of Strings Should Be Ordered ASC    ${billStatus}
    #    Click Element    ${colDateOfCreation}
    #    ${billStatus} =    Get Elements Texts    ${grdBills}/div[contains(@class,'gridcontainer')]/table/tbody/tr/td[5]/div
    #    List Of Strings Should Be Ordered DESC    ${billStatus}
    # Check Sort By Positionen
    #    [Documentation]    BILL -> Rechnungsverwaltung -> Übersicht: Sortierung nach Spalte "Erstellt am"
    #    [Tags]    Sorting
    #    Sleep    1
    #    Click Element    ${colPositionCount}
    #    ${billStatus} =    Get Elements Texts    ${grdBills}/div[contains(@class,'gridcontainer')]/table/tbody/tr/td[6]/div
    #    List Of Strings Should Be Ordered ASC    ${billStatus}
    #    Click Element    ${colPositionCount}
    #    ${billStatus} =    Get Elements Texts    ${grdBills}/div[contains(@class,'gridcontainer')]/table/tbody/tr/td[6]/div
    #    List Of Strings Should Be Ordered DESC    ${billStatus}
    # Check Sort By Proforma
    #    [Documentation]    BILL -> Rechnungsverwaltung -> Übersicht: Sortierung nach Spalte "Erstellt am"
    #    [Tags]    Sorting
    #    Sleep    1
    #    Click Element    ${colProforma}
    #    ${billStatus} =    Get Elements Texts    ${grdBills}/div[contains(@class,'gridcontainer')]/table/tbody/tr/td[6]/div
    #    List Of Strings Should Be Ordered ASC    ${billStatus}
    #    Click Element    ${colProforma}
    #    ${billStatus} =    Get Elements Texts    ${grdBills}/div[contains(@class,'gridcontainer')]/table/tbody/tr/td[6]/div
    #    List Of Strings Should Be Ordered DESC    ${billStatus}
