*** Settings ***
Documentation     Menüpunktes BILL -> Rechnungsverwaltung: Rechnungsübersicht
Suite Setup       Select Rechnungsverwaltung    true
Suite Teardown    Close Browser
Force Tags        Bill    Rechnungsverwaltung
Default Tags
Resource          ../../UserKeywords/Common_Resources.html
Resource          ../../UserKeywords/BILL_Resources.html
Resource          PageObjects/Rechnungsverwaltung_Overview.txt
Resource          PageObjects/Menu.txt
Library           ../../Libs/ActionChainsExtension.py
Variables         PageObjects/Rechnungsverwaltung_Overview.yaml

*** Test Cases ***
No Invoice Selected
    [Documentation]    BILL -> Rechnungsverwaltung: Status der Buttons, wenn kein Element selektiert ist
    [Tags]    InvoiceSelection
    Element Should Be Enabled    ${chkShowClosedBills}
    Element Should Be Enabled    ${chkShowProcessedBills}
    Element Should Be Enabled    ${chkShowProformaBills}
    Element Should Be Enabled    ${btnCreateBill}
    Element Should Be Enabled    ${btnAbort}
    Element Should Be Disabled    ${btnRecalculate}
    Element Should Be Disabled    ${btnEditBill}
    Element Should Be Disabled    ${btnDeleteBill}
    Element Should Be Disabled    ${btnReopenBill}
    Element Should Be Disabled    ${btnCloseBill}
    Element Should Be Disabled    ${btnProcessBill}
    Element Should Be Disabled    ${btnExportInvoices}

Open Invoice Selected
    [Documentation]    BILL -> Rechnungsverwaltung: Status der Buttons, wenn Rechnung selektiert ist im Status "In Bearbeitung"
    [Tags]    InvoiceSelection
    Click Element    ${invOpen}
    Status of Invoice Should Be    ${invOpen}    In Bearbeitung
    Element Should Be Enabled    ${chkShowClosedBills}
    Element Should Be Enabled    ${chkShowProcessedBills}
    Element Should Be Enabled    ${chkShowProformaBills}
    Element Should Be Enabled    ${btnCreateBill}
    Element Should Be Enabled    ${btnAbort}
    Element Should Be Enabled    ${btnRecalculate}
    Element Should Be Enabled    ${btnEditBill}
    Element Should Be Enabled    ${btnDeleteBill}
    Element Should Be Disabled    ${btnReopenBill}
    Element Should Be Enabled    ${btnCloseBill}
    Element Should Be Enabled    ${btnProcessBill}
    Element Should Be Enabled    ${btnExportInvoices}

Processed Invoice Selected
    [Documentation]    BILL -> Rechnungsverwaltung: Status der Buttons, wenn Rechnung selektiert ist im Status "Verarbeitet"
    [Tags]    InvoiceSelection
    Click Element    ${invProcessed}
    Status of Invoice Should Be    ${invProcessed}    Verarbeitet
    Element Should Be Enabled    ${chkShowClosedBills}
    Element Should Be Enabled    ${chkShowProcessedBills}
    Element Should Be Enabled    ${chkShowProformaBills}
    Element Should Be Enabled    ${btnCreateBill}
    Element Should Be Enabled    ${btnAbort}
    Element Should Be Disabled    ${btnRecalculate}
    Element Should Be Enabled    ${btnEditBill}
    Element Should Be Enabled    ${btnDeleteBill}
    Element Should Be Disabled    ${btnReopenBill}
    Element Should Be Disabled    ${btnCloseBill}
    Element Should Be Disabled    ${btnProcessBill}
    Element Should Be Enabled    ${btnExportInvoices}

Processed Closed Invoice Selected
    [Documentation]    BILL -> Rechnungsverwaltung: Status der Buttons, wenn Rechnung selektiert ist im Status "Verarbeitet"
    [Tags]    InvoiceSelection
    Click Element    ${invProcessedClosed}
    Status of Invoice Should Be    ${invProcessedClosed}    Verarbeitet & veröffentlicht
    Element Should Be Enabled    ${chkShowClosedBills}
    Element Should Be Enabled    ${chkShowProcessedBills}
    Element Should Be Enabled    ${chkShowProformaBills}
    Element Should Be Enabled    ${btnCreateBill}
    Element Should Be Enabled    ${btnAbort}
    Element Should Be Disabled    ${btnRecalculate}
    Element Should Be Enabled    ${btnEditBill}
    Element Should Be Enabled    ${btnDeleteBill}
    Element Should Be Disabled    ${btnReopenBill}
    Element Should Be Disabled    ${btnCloseBill}
    Element Should Be Disabled    ${btnProcessBill}
    Element Should Be Enabled    ${btnExportInvoices}

Closed Invoice Selected
    [Documentation]    BILL -> Rechnungsverwaltung: Status der Buttons, wenn Rechnung selektiert ist im Status "Veröffentlicht"
    [Tags]    InvoiceSelection
    Click Element    ${invClosed}
    Status of Invoice Should Be    ${invClosed}    Veröffentlicht
    Element Should Be Enabled    ${chkShowClosedBills}
    Element Should Be Enabled    ${chkShowProcessedBills}
    Element Should Be Enabled    ${chkShowProformaBills}
    Element Should Be Enabled    ${btnCreateBill}
    Element Should Be Enabled    ${btnAbort}
    Element Should Be Disabled    ${btnRecalculate}
    Element Should Be Enabled    ${btnEditBill}
    Element Should Be Enabled    ${btnDeleteBill}
    Element Should Be Enabled    ${btnReopenBill}
    Element Should Be Disabled    ${btnCloseBill}
    Element Should Be Enabled    ${btnProcessBill}
    Element Should Be Enabled    ${btnExportInvoices}

Multiple Invoices selected
    [Documentation]    BILL -> Rechnungsverwaltung: Status der Buttons, wenn mehrere Elemente selektiert sind
    [Tags]    InvoiceSelection
    ${ids}    Create List    ${invProcessed}    ${invProcessedClosed}/$invoiceNumber
    Select Elements With CONTROL    ${ids}
    Run Keyword And Continue On Failure    Invoice Should Be Selected    ${invProcessed}
    Run Keyword And Continue On Failure    Invoice Should Be Selected    ${invProcessedClosed}
    Select Elements With SHIFT    ${invProcessed}    ${invProcessedClosed}
    Invoice Should Be Selected    ${invProcessed}
    Invoice Should Be Selected    ${invProcessedClosed}
    Element Should Be Enabled    ${chkShowClosedBills}
    Element Should Be Enabled    ${chkShowProcessedBills}
    Element Should Be Enabled    ${chkShowProformaBills}
    Element Should Be Enabled    ${btnCreateBill}
    Element Should Be Enabled    ${btnAbort}
    Element Should Be Disabled    ${btnRecalculate}
    Element Should Be Disabled    ${btnEditBill}
    Element Should Be Disabled    ${btnDeleteBill}
    Element Should Be Disabled    ${btnReopenBill}
    Element Should Be Disabled    ${btnCloseBill}
    Element Should Be Disabled    ${btnProcessBill}
    Element Should Be Disabled    ${btnExportInvoices}

Check Languagedependent Text Content
    [Tags]    Languagedependent
    Sleep    1
    : FOR    ${key}    IN    @{AVAILABLE_LANGUAGES.keys()}
    \    Set LanguageId    ${key}
    \    Sleep    1
    \    Check LanguageId is selected    ${key}
    \    ${language_code} =    Get Selected LanguageCode
    \    Run Keyword And Continue On Failure    Element Text Should Be    ${lblHeadline}    &{DicYAML_Rechnungsverwaltung}[${language_code}]
    \    Run Keyword And Continue On Failure    Element Text Should Be    ${colProforma}    &{DicYAML_Proforma}[${language_code}]
    \    Run Keyword And Continue On Failure    Element Text Should Be    ${colInvoiceNo}    &{DicYAML_Rechnungs-Nr.}[${language_code}]
    \    Run Keyword And Continue On Failure    Element Text Should Be    ${colInvoiceName}    &{DicYAML_Rechnungsbezeichnung}[${language_code}]
    \    Run Keyword And Continue On Failure    Element Text Should Be    ${colStatus}    &{DicYAML_Status}[${language_code}]
    \    Run Keyword And Continue On Failure    Element Text Should Be    ${colDateOfCreation}    &{DicYAML_Erstellt am}[${language_code}]
    \    Run Keyword And Continue On Failure    Element Text Should Be    ${colPositionCount}    &{DicYAML_Positionen}[${language_code}]
    \    Run Keyword And Continue On Failure    Check LabelText    ${chkShowClosedBills}    &{DicYAML_Auch bereits veröffentlichte Rechnungen mit anzeigen}[${language_code}]
    \    Run Keyword And Continue On Failure    Check LabelText    ${chkShowProcessedBills}    &{DicYAML_Auch bereits verarbeitete Rechnungen mit anzeigen}[${language_code}]
    \    Run Keyword And Continue On Failure    Check LabelText    ${chkShowProformaBills}    &{DicYAML_Auch Proformarechnungen mit anzeigen}[${language_code}]
    \    Run Keyword And Continue On Failure    Element Text Should Be    ${btnCreateBill}    &{DicYAML_Neue Rechnung eröffnen}[${language_code}]
    \    Run Keyword And Continue On Failure    Element Text Should Be    ${btnEditBill}    &{DicYAML_Rechnung bearbeiten}[${language_code}]
    \    Run Keyword And Continue On Failure    Element Text Should Be    ${btnDeleteBill}    &{DicYAML_Rechnung löschen}[${language_code}]
    \    Run Keyword And Continue On Failure    Element Text Should Be    ${btnReopenBill}    &{DicYAML_Rechnung zurückziehen}[${language_code}]
    \    Run Keyword And Continue On Failure    Element Text Should Be    ${btnCloseBill}    &{DicYAML_Rechnung veröffentlichen}[${language_code}]
    \    Run Keyword And Continue On Failure    Element Text Should Be    ${btnProcessBill}    &{DicYAML_Rechnung ist verarbeitet}[${language_code}]
    \    Run Keyword And Continue On Failure    Element Text Should Be    ${btnRecalculate}    &{DicYAML_Preise erneut berechnen}[${language_code}]
    \    Run Keyword And Continue On Failure    Element Text Should Be    ${btnAbort}    &{DicYAML_Vorgang abbrechen}[${language_code}]
    \    Run Keyword And Continue On Failure    Element Text Should Be    ${btnExportInvoices}    &{DicYAML_Rechnungsexport}[${language_code}]
    \    Sleep    1
