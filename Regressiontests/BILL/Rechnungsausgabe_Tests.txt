*** Settings ***
Suite Setup       Select Rechnungsausgabe    true
Suite Teardown    Close Browser
Test Teardown     Teardown Rechnungsausgabe
Force Tags        Bill    Rechnungsausgabe
Default Tags
Resource          ../../UserKeywords/Common_Resources.html
Resource          PageObjects/Menu.txt
Resource          ../General_PageObjects/Message_PopUp.txt
Resource          PageObjects/Rechnungsausgabe.txt
Variables         PageObjects/Rechnungsausgabe.yaml

*** Test Cases ***
Check GUI Elements Rechnungsausgabe
    [Documentation]    MM 22.03.2018, Check GUI Elements for Rechnugsausgabe
    [Tags]    GUI_Elements    TextLanguagedependent
    ${langunge_code}=    Get selected LanguageCode
    #title
    Check ContainsText    &{Dic_Title}[${langunge_code}]
    #grid
    Check ElementId    ${colInvoiceNumber}    &{Dic_colInvoiceNumber}[${langunge_code}]    enabled=true
    Check ElementId    ${colDescription}    &{Dic_colDescription}[${langunge_code}]    enabled=true
    Check ElementId    ${colStatus}    &{Dic_colStatus}[${langunge_code}]    enabled=true
    Check ElementId    ${colCreationDate}    &{Dic_colCreationDate}[${langunge_code}]    enabled=true
    Check ElementId    ${colItems}    &{Dic_colItems}[${langunge_code}]    enabled=true
    #checkbox
    Check CheckboxId    ${chkShowOnlyOpenBills}    &{Dic_chkShowOnlyOpenBills}[${langunge_code}]    enabled=true    selected=false
    Check CheckboxId    ${chkShowProcessedBills}    &{Dic_chkShowProcessedBills}[${langunge_code}]    enabled=true    selected=false
    Check CheckboxId    ${chkShowProformaBills}    &{Dic_chkShowProformaBills}[${langunge_code}]    enabled=true    selected=false
    Check CheckboxId    ${chkPrintLogo}    &{Dic_chkPrintLogo}[${langunge_code}]    enabled=true    selected=false
    Check CheckboxId    ${chkAddCopy}    &{Dic_chkAddCopy}[${langunge_code}]    enabled=true    selected=false
    #textfield
    Check TextfieldId    ${txtEmail}    ${DEFAULT_EMAIL_ADRESS}    enabled=true    labeltext=&{Dic_txtEmail}[${langunge_code}]
    #buttons
    Check ElementId    ${btnThirdParty}    &{Dic_btnThirdParty}[${langunge_code}]    enabled=false
    Check ElementId    ${btnProForma}    &{Dic_btnProForma}[${langunge_code}]    enabled=false
    Check ElementId    ${btnAbort}    &{Dic_btnAbort}[${langunge_code}]    enabled=true

Check Text Languagedependent
    [Tags]    TextLanguagedependent    ChangeLanguage
    : FOR    ${key}    IN    @{AVAILABLE_LANGUAGES.keys()}
    \    Set LanguageId    ${key}
    \    Check LanguageId is selected    ${key}
    \    ${langunge_code}=    Get selected LanguageCode
    \    Run Keyword And Continue On Failure    Check ContainsText    &{Dic_Title}[${langunge_code}]
    \    Run Keyword And Continue On Failure    Element Text Should Be    ${colInvoiceNumber}    &{Dic_colInvoiceNumber}[${langunge_code}]
    \    Run Keyword And Continue On Failure    Element Text Should Be    ${colDescription}    &{Dic_colDescription}[${langunge_code}]
    \    Run Keyword And Continue On Failure    Element Text Should Be    ${colStatus}    &{Dic_colStatus}[${langunge_code}]
    \    Run Keyword And Continue On Failure    Element Text Should Be    ${colCreationDate}    &{Dic_colCreationDate}[${langunge_code}]
    \    Run Keyword And Continue On Failure    Element Text Should Be    ${colItems}    &{Dic_colItems}[${langunge_code}]
    \    Run Keyword And Continue On Failure    Check LabelText    ${chkShowOnlyOpenBills}    &{Dic_chkShowOnlyOpenBills}[${langunge_code}]
    \    Run Keyword And Continue On Failure    Check LabelText    ${chkShowProcessedBills}    &{Dic_chkShowProcessedBills}[${langunge_code}]
    \    Run Keyword And Continue On Failure    Check LabelText    ${chkShowProformaBills}    &{Dic_chkShowProformaBills}[${langunge_code}]
    \    Run Keyword And Continue On Failure    Check LabelText    ${chkPrintLogo}    &{Dic_chkPrintLogo}[${langunge_code}]
    \    Run Keyword And Continue On Failure    Check LabelText    ${chkAddCopy}    &{Dic_chkAddCopy}[${langunge_code}]
    \    Run Keyword And Continue On Failure    Check ContainsText    &{Dic_txtEmail}[${langunge_code}]
    \    Run Keyword And Continue On Failure    Element Text Should Be    ${btnThirdParty}    &{Dic_btnThirdParty}[${langunge_code}]
    \    Run Keyword And Continue On Failure    Element Text Should Be    ${btnProForma}    &{Dic_btnProForma}[${langunge_code}]
    \    Run Keyword And Continue On Failure    Element Text Should Be    ${btnAbort}    &{Dic_btnAbort}[${langunge_code}]
    Set LanguageId    ${DEFAULT_LANGUAGE_ID}

Check Valid Email
    [Tags]    Action
    Input Text    ${txtEmail}    support@rigilog.com
    Check ElementId with class is visible    ${txtEmail}    invalid    visible=false
    Input Text    ${txtEmail}    support@rigilog
    Check ElementId with class is visible    ${txtEmail}    invalid    visible=true
    Input Text    ${txtEmail}    ''
    Check ElementId with class is visible    ${txtEmail}    invalid    visible=true

Check Sort By Rechnungs-Nr
    [Documentation]    BILL -> Rechnungsausgabe -> Übersicht: Sortierung nach Spalte "Rechnungs-Nr."
    [Tags]    Sorting
    Check Sorting Table By Columnname    ${listInvoice}    $invoiceNumber

Check Sort By Rechnungsbezeichnung
    [Documentation]    BILL -> Rechnungsausgabe -> Übersicht: Sortierung nach Spalte "Rechnungsbezeichnung."
    [Tags]    Sorting
    Check Sorting Table By Columnname    ${listInvoice}    $description

Check Sort By Status
    [Documentation]    BILL -> Rechnungsausgabe -> Übersicht: Sortierung nach Spalte "Status."
    [Tags]    Sorting
    Check Sorting Table By Columnname    ${listInvoice}    $status

Check Sort By Erstellt am
    [Documentation]    BILL -> Rechnungsausgabe -> Übersicht: Sortierung nach Spalte "Erstellt am."
    [Tags]    Sorting
    Check Sorting Table By Columnname    ${listInvoice}    $creationDate    data_type=datetime

Check Sort By Positionen
    [Documentation]    BILL -> Rechnungsausgabe -> Übersicht: Sortierung nach Spalte "Positionen."
    [Tags]    Sorting
    Check Sorting Table By Columnname    ${listInvoice}    $items    data_type=int

Check No Invoice Selected
    [Documentation]    BILL -> Rechnungsausgabe: Status der Buttons, wenn kein Element selektiert ist
    [Tags]    Action
    ${invoiceIsSelected}    Check List has selection    ${listInvoice}
    Should Be Equal    ${invoiceIsSelected}    ${FALSE}
    Check CheckboxId    ${chkShowOnlyOpenBills}    enabled=true    selected=false
    Check CheckboxId    ${chkShowProcessedBills}    enabled=true    selected=false
    Check CheckboxId    ${chkShowProformaBills}    enabled=true    selected=false
    Check CheckboxId    ${chkPrintLogo}    enabled=true    selected=false
    Check CheckboxId    ${chkAddCopy}    enabled=true    selected=false
    Check ElementId    ${btnThirdParty}    enabled=false
    Check ElementId    ${btnProForma}    enabled=false
    Check ElementId    ${btnAbort}    enabled=true

Select Open Invoice DBConnection
    [Documentation]    BILL -> Rechnungsausgabe: Status der Buttons, wenn Rechnung selektiert ist im Status "In Bearbeitung"
    [Tags]    Action    DBConnection
    ${langunge_code}=    Get selected LanguageCode
    ${invoiceIsSelected}    Check List has selection    ${listInvoice}
    Should Be Equal    ${invoiceIsSelected}    ${FALSE}
    ${queryResultInvNo}=    Get InvoiceNo From Database    Retrieve_OpenBills
    ${InvoiceID}    Get InvoiceID    ${listInvoice}    $invoiceNumber    ${queryResultInvNo}
    ${selectInvoice}=    Check Invoice is selectable    ${InvoiceID}
    Run Keyword If    ${selectInvoice}    Select InvoiceID    ${InvoiceID}
    Run Keyword If    ${selectInvoice}    Element Text Should Be    ${InvoiceID}/$status    &{Dic_IsOpen}[${langunge_code}]
    Check CheckboxId    ${chkShowOnlyOpenBills}    enabled=true    selected=false
    Check CheckboxId    ${chkShowProcessedBills}    enabled=true    selected=false
    Check CheckboxId    ${chkShowProformaBills}    enabled=true    selected=false
    Check CheckboxId    ${chkPrintLogo}    enabled=true    selected=false
    Check CheckboxId    ${chkAddCopy}    enabled=true    selected=false
    Check ElementId    ${btnThirdParty}    enabled=${selectInvoice}
    Check ElementId    ${btnProForma}    enabled=${selectInvoice}
    Check ElementId    ${btnAbort}    enabled=true

Select Complete Invoice DBConnection
    [Documentation]    BILL -> Rechnungsausgabe: Status der Buttons, wenn Rechnung selektiert ist im Status "Veröffentlicht"
    [Tags]    Action    DBConnection
    ${langunge_code}=    Get selected LanguageCode
    ${invoiceIsSelected}    Check List has selection    ${listInvoice}
    Should Be Equal    ${invoiceIsSelected}    ${FALSE}
    Click Element And Wait    ${chkShowOnlyOpenBills}
    ${queryResultInvNo}=    Get InvoiceNo From Database    Retrieve_CompleteBills
    ${InvoiceID}    Get InvoiceID    ${listInvoice}    $invoiceNumber    ${queryResultInvNo}
    ${selectInvoice}=    Check Invoice is selectable    ${InvoiceID}
    Run Keyword If    ${selectInvoice}    Select InvoiceID    ${InvoiceID}
    Run Keyword If    ${selectInvoice}    Element Text Should Be    ${InvoiceID}/$status    &{Dic_IsComplete}[${langunge_code}]
    Check CheckboxId    ${chkShowOnlyOpenBills}    enabled=true    selected=true
    Check CheckboxId    ${chkShowProcessedBills}    enabled=true    selected=false
    Check CheckboxId    ${chkShowProformaBills}    enabled=true    selected=false
    Check CheckboxId    ${chkPrintLogo}    enabled=true    selected=false
    Check CheckboxId    ${chkAddCopy}    enabled=true    selected=false
    Check ElementId    ${btnThirdParty}    enabled=${selectInvoice}
    Check ElementId    ${btnProForma}    enabled=${selectInvoice}
    Check ElementId    ${btnAbort}    enabled=true

Select Processed Invoice DBConnection
    [Documentation]    BILL -> Rechnungsausgabe: Status der Buttons, wenn Rechnung selektiert ist im Status "Verarbeitet"
    [Tags]    Action    DBConnection
    ${langunge_code}=    Get selected LanguageCode
    ${invoiceIsSelected}    Check List has selection    ${listInvoice}
    Should Be Equal    ${invoiceIsSelected}    ${FALSE}
    Click Element And Wait    ${chkShowProcessedBills}
    ${queryResultInvNo}=    Get InvoiceNo From Database    Retrieve_ProcessedBills
    ${InvoiceID}    Get InvoiceID    ${listInvoice}    $invoiceNumber    ${queryResultInvNo}
    ${selectInvoice}=    Check Invoice is selectable    ${InvoiceID}
    Run Keyword If    ${selectInvoice}    Select InvoiceID    ${InvoiceID}
    Run Keyword If    ${selectInvoice}    Element Text Should Be    ${InvoiceID}/$status    &{Dic_IsProcessed}[${langunge_code}]
    Check CheckboxId    ${chkShowOnlyOpenBills}    enabled=true    selected=false
    Check CheckboxId    ${chkShowProcessedBills}    enabled=true    selected=true
    Check CheckboxId    ${chkShowProformaBills}    enabled=true    selected=false
    Check CheckboxId    ${chkPrintLogo}    enabled=true    selected=false
    Check CheckboxId    ${chkAddCopy}    enabled=true    selected=false
    Check ElementId    ${btnThirdParty}    enabled=false
    Check ElementId    ${btnProForma}    enabled=false
    Check ElementId    ${btnAbort}    enabled=true

Select Processed Closed Invoice DBConnection
    [Documentation]    BILL -> Rechnungsausgabe: Status der Buttons, wenn Rechnung selektiert ist im Status "Verarbeitet & veröffentlicht"
    [Tags]    Action    DBConnection
    ${langunge_code}=    Get selected LanguageCode
    ${invoiceIsSelected}    Check List has selection    ${listInvoice}
    Should Be Equal    ${invoiceIsSelected}    ${FALSE}
    Click Element And Wait    ${chkShowProcessedBills}
    ${queryResultInvNo}=    Get InvoiceNo From Database    Retrieve_CompleteAndProcessedBills
    ${InvoiceID}    Get InvoiceID    ${listInvoice}    $invoiceNumber    ${queryResultInvNo}
    ${selectInvoice}=    Check Invoice is selectable    ${InvoiceID}
    Run Keyword If    ${selectInvoice}    Select InvoiceID    ${InvoiceID}
    Run Keyword If    ${selectInvoice}    Element Text Should Be    ${InvoiceID}/$status    &{Dic_IsCompleteAndProcessed}[${langunge_code}]
    Check CheckboxId    ${chkShowOnlyOpenBills}    enabled=true    selected=false
    Check CheckboxId    ${chkShowProcessedBills}    enabled=true    selected=true
    Check CheckboxId    ${chkShowProformaBills}    enabled=true    selected=false
    Check CheckboxId    ${chkPrintLogo}    enabled=true    selected=false
    Check CheckboxId    ${chkAddCopy}    enabled=true    selected=false
    Check ElementId    ${btnThirdParty}    enabled=false
    Check ElementId    ${btnProForma}    enabled=false
    Check ElementId    ${btnAbort}    enabled=true

Select Proforma Invoice DBConnection
    [Documentation]    BILL -> Rechnungsausgabe: Status der Buttons, wenn auch Profomarechnung anzeigen selektiert ist
    [Tags]    Action    DBConnection
    ${langunge_code}=    Get selected LanguageCode
    ${invoiceIsSelected}    Check List has selection    ${listInvoice}
    Should Be Equal    ${invoiceIsSelected}    ${FALSE}
    Click Element And Wait    ${chkShowProformaBills}
    ${queryResultInvNo}=    Get InvoiceNo From Database    Retrieve_OpenProformaBills
    ${InvoiceID}    Get InvoiceID    ${listInvoice}    $invoiceNumber    ${queryResultInvNo}
    ${selectInvoice}=    Check Invoice is selectable    ${InvoiceID}
    Run Keyword If    ${selectInvoice}    Select InvoiceID    ${InvoiceID}
    Run Keyword If    ${selectInvoice}    Element Text Should Be    ${InvoiceID}/$status    &{Dic_IsOpen}[${langunge_code}]
    Check CheckboxId    ${chkShowOnlyOpenBills}    enabled=true    selected=false
    Check CheckboxId    ${chkShowProcessedBills}    enabled=true    selected=false
    Check CheckboxId    ${chkShowProformaBills}    enabled=true    selected=true
    Check CheckboxId    ${chkPrintLogo}    enabled=true    selected=false
    Check CheckboxId    ${chkAddCopy}    enabled=true    selected=false
    Check ElementId    ${btnThirdParty}    enabled=${selectInvoice}
    Check ElementId    ${btnProForma}    enabled=${selectInvoice}
    Check ElementId    ${btnAbort}    enabled=true

Click Logo mit aufdrucken
    [Tags]    Action
    ${passed} =    Run Keyword And Return Status    Click Element And Wait    ${chkPrintLogo}
    Should Be Equal    ${passed}    ${TRUE}

Click Kopie anfügen
    [Tags]    Action
    ${passed}    Run Keyword And Return Status    Click Element And Wait    ${chkAddCopy}
    Should Be Equal    ${passed}    ${TRUE}

Click Button Rechnung mit Positionen
    [Tags]    Action
    ${InvoiceID}    Get InvoiceID with Positions    ${listInvoice}
    Select InvoiceID    ${InvoiceID}
    Click Element And Wait    ${btnThirdParty}
    Message_PopUp.Check Message PopUp Is Visible    visible=false

Click Button Rechnung ohne Positionen
    [Tags]    Action
    ${InvoiceID}    Get InvoiceID    ${listInvoice}    $items    0
    Select InvoiceID    ${InvoiceID}
    Click Element And Wait    ${btnThirdParty}
    Message_PopUp.Check Message PopUp Is Visible    visible=true
    Message_PopUp.Check Error Message PopUp    &{Dic_ErrorMsg}
    Message_PopUp.Click Close Button
    Message_PopUp.Check Message PopUp Is Visible    visible=false
    Click Element And Wait    ${btnThirdParty}
    Message_PopUp.Check Message PopUp Is Visible    visible=true
    Message_PopUp.Click OK Button
    Message_PopUp.Check Message PopUp Is Visible    visible=false

Click Button Proformarechnung mit Positionen
    [Tags]    Action
    ${InvoiceID}    Get InvoiceID with Positions    ${listInvoice}
    Select InvoiceID    ${InvoiceID}
    Click Element And Wait    ${btnThirdParty}
    Message_PopUp.Check Message PopUp Is Visible    visible=false

Click Button Proformarechnung ohne Positionen
    [Tags]    Action
    ${InvoiceID}    Get InvoiceID    ${listInvoice}    $items    0
    Select InvoiceID    ${InvoiceID}
    Click Element And Wait    ${btnProForma}
    Message_PopUp.Check Message PopUp Is Visible    visible=true
    Message_PopUp.Check Error Message PopUp    &{Dic_ErrorMsg}
    Message_PopUp.Click Close Button
    Message_PopUp.Check Message PopUp Is Visible    visible=false
    Click Element And Wait    ${btnProForma}
    Message_PopUp.Check Message PopUp Is Visible    visible=true
    Message_PopUp.Click OK Button
    Message_PopUp.Check Message PopUp Is Visible    visible=false

Click Button Zurück zum Hauptmenü
    [Tags]    Action
    Click Element And Wait    ${btnAbort}
    Check PageArea is visible    ${menu_content}    ${invoice_issue_class}    visible=false
    Check Homescreen is selected
