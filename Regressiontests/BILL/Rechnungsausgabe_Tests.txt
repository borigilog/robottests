*** Settings ***
Suite Setup       Select Rechnungsausgabe    true
Suite Teardown    Close Browser
Test Teardown     Select Rechnungsausgabe
Resource          ../../UserKeywords/Common_Resources.html
Resource          ../../UserKeywords/BILL_Resources.html
Resource          PageObjects/Menu.txt
Resource          PageObjects/Rechnungsausgabe.txt
Variables         PageObjects/Rechnungsausgabe.yaml
Library           DatabaseLibrary
Library           ../../Libs/DatabaseClass.py    database=${DATABASE_NAME}    user=${DATABASE_USER}    password=${DATABASE_PWD}    host=${DATABASE_IP}    port=${DATABASE_PORT}

*** Test Cases ***
Check GUI Elements Rechnungsausgabe
    [Documentation]    MM 22.03.2018, Check GUI Elements for Rechnugsausgabe
    [Tags]    Bill    Rechnungsausgabe
    ${langunge_code}=    Get selected LanguageCode
    #title
    Check ContainsText    &{Dic_Title}[${langunge_code}]
    #grid
    Check ElementId    ${colInvoiceNumber}    &{Dic_colInvoiceNumber}[${langunge_code}]    enabled=true
    Check ElementId    ${colDescription}    &{Dic_colDescription}[${langunge_code}]    enabled=true
    Check ElementId    ${colStatus}    &{Dic_colStatus}[${langunge_code}]    enabled=true
    Check ElementId    ${colCreationDate}    &{Dic_colCreationDate}[${langunge_code}]    enabled=true
    Check ElementId    ${colItems}    &{Dic_colItems}[${langunge_code}]    enabled=true
    #checkbox
    Check CheckboxId    ${chkShowOnlyOpenBills}    &{Dic_chkShowOnlyOpenBills}[${langunge_code}]    enabled=true    selected=false
    Check CheckboxId    ${chkShowProcessedBills}    &{Dic_chkShowProcessedBills}[${langunge_code}]    enabled=true    selected=false
    Check CheckboxId    ${chkShowProformaBills}    &{Dic_chkShowProformaBills}[${langunge_code}]    enabled=true    selected=false
    Check CheckboxId    ${chkPrintLogo}    &{Dic_chkPrintLogo}[${langunge_code}]    enabled=true    selected=false
    Check CheckboxId    ${chkAddCopy}    &{Dic_chkAddCopy}[${langunge_code}]    enabled=true    selected=false
    #textfield
    Check TextfieldId    ${txtEmail}    support@rigilog.com    enabled=true    labeltext=&{Dic_txtEmail}[${langunge_code}]
    #buttons
    Check ElementId    ${btnThirdParty}    &{Dic_btnThirdParty}[${langunge_code}]    enabled=false
    Check ElementId    ${btnProForma}    &{Dic_btnProForma}[${langunge_code}]    enabled=false
    Check ElementId    ${btnAbort}    &{Dic_btnAbort}[${langunge_code}]    enabled=true
    ${passed} =    Run Keyword And Return Status    Click Button    ${btnAbort}
    Should Be Equal    ${passed}    ${TRUE}
    Check PageArea is visible    ${menu_content}    ${invoice_issue_class}    visible=false
    Check Homescreen is selected

Check Text Languagedependent
    Sleep    1s
    : FOR    ${key}    IN    @{AVAILABLE_LANGUAGES.keys()}
    \    Set LanguageId    ${key}
    \    Sleep    1s
    \    Check LanguageId is selected    ${key}
    \    ${langunge_code}=    Get selected LanguageCode
    \    Run Keyword And Continue On Failure    Check ContainsText    &{Dic_Title}[${langunge_code}]
    \    Run Keyword And Continue On Failure    Element Text Should Be    ${colInvoiceNumber}    &{Dic_colInvoiceNumber}[${langunge_code}]
    \    Run Keyword And Continue On Failure    Element Text Should Be    ${colDescription}    &{Dic_colDescription}[${langunge_code}]
    \    Run Keyword And Continue On Failure    Element Text Should Be    ${colStatus}    &{Dic_colStatus}[${langunge_code}]
    \    Run Keyword And Continue On Failure    Element Text Should Be    ${colCreationDate}    &{Dic_colCreationDate}[${langunge_code}]
    \    Run Keyword And Continue On Failure    Element Text Should Be    ${colItems}    &{Dic_colItems}[${langunge_code}]
    \    Run Keyword And Continue On Failure    Check LabelText    ${chkShowOnlyOpenBills}    &{Dic_chkShowOnlyOpenBills}[${langunge_code}]
    \    Run Keyword And Continue On Failure    Check LabelText    ${chkShowProcessedBills}    &{Dic_chkShowProcessedBills}[${langunge_code}]
    \    Run Keyword And Continue On Failure    Check LabelText    ${chkShowProformaBills}    &{Dic_chkShowProformaBills}[${langunge_code}]
    \    Run Keyword And Continue On Failure    Check LabelText    ${chkPrintLogo}    &{Dic_chkPrintLogo}[${langunge_code}]
    \    Run Keyword And Continue On Failure    Check LabelText    ${chkAddCopy}    &{Dic_chkAddCopy}[${langunge_code}]
    \    Run Keyword And Continue On Failure    Check ContainsText    &{Dic_txtEmail}[${langunge_code}]
    \    Run Keyword And Continue On Failure    Element Text Should Be    ${btnThirdParty}    &{Dic_btnThirdParty}[${langunge_code}]
    \    Run Keyword And Continue On Failure    Element Text Should Be    ${btnProForma}    &{Dic_btnProForma}[${langunge_code}]
    \    Run Keyword And Continue On Failure    Element Text Should Be    ${btnAbort}    &{Dic_btnAbort}[${langunge_code}]

Check Valid Email
    Input Text    ${txtEmail}    support@rigilog.com
    Check ElementId with class is visible    ${txtEmail}    invalid    visible=false
    Input Text    ${txtEmail}    support@rigilog
    Check ElementId with class is visible    ${txtEmail}    invalid    visible=true

Check No Invoice Selected
    [Documentation]    BILL -> Rechnungsausgabe: Status der Buttons, wenn kein Element selektiert ist
    ${invoiceIsSelected}    Check List has selection    ${listInvoice}
    Should Be Equal    ${invoiceIsSelected}    ${FALSE}
    Check CheckboxId    ${chkShowOnlyOpenBills}    enabled=true    selected=false
    Check CheckboxId    ${chkShowProcessedBills}    enabled=true    selected=false
    Check CheckboxId    ${chkShowProformaBills}    enabled=true    selected=false
    Check CheckboxId    ${chkPrintLogo}    enabled=true    selected=false
    Check CheckboxId    ${chkAddCopy}    enabled=true    selected=false
    Check ElementId    ${btnThirdParty}    enabled=false
    Check ElementId    ${btnProForma}    enabled=false
    Check ElementId    ${btnAbort}    enabled=true

Select Open Invoice DBConnection
    [Documentation]    BILL -> Rechnungsausgabe: Status der Buttons, wenn Rechnung selektiert ist im Status "In Bearbeitung"
    ${langunge_code}=    Get selected LanguageCode
    ${invoiceIsSelected}    Check List has selection    ${listInvoice}
    Should Be Equal    ${invoiceIsSelected}    ${FALSE}
    ${queryResultInvNo}=    DB_Execute_Scalar    ${expectedBills_SQL} AND (Bills.IsComplete = 0) AND (Bills.IsProcessed = 0)
    ${InvoiceID}    Get InvoiceID    ${listInvoice}    $invoiceNumber    ${queryResultInvNo}
    ${selectInvoice}=    Check Invoice is selectable    ${InvoiceID}
    Run Keyword If    ${selectInvoice}    Select InvoiceID    ${InvoiceID}
    Run Keyword If    ${selectInvoice}    Element Text Should Be    ${InvoiceID}/$status    &{Dic_IsOpen}[${langunge_code}]
    Check CheckboxId    ${chkShowOnlyOpenBills}    enabled=true    selected=false
    Check CheckboxId    ${chkShowProcessedBills}    enabled=true    selected=false
    Check CheckboxId    ${chkShowProformaBills}    enabled=true    selected=false
    Check CheckboxId    ${chkPrintLogo}    enabled=true    selected=false
    Check CheckboxId    ${chkAddCopy}    enabled=true    selected=false
    Check ElementId    ${btnThirdParty}    enabled=${selectInvoice}
    Check ElementId    ${btnProForma}    enabled=${selectInvoice}
    Check ElementId    ${btnAbort}    enabled=true

Select Complete Invoice DBConnection
    [Documentation]    BILL -> Rechnungsausgabe: Status der Buttons, wenn Rechnung selektiert ist im Status "Veröffentlicht"
    ${langunge_code}=    Get selected LanguageCode
    ${invoiceIsSelected}    Check List has selection    ${listInvoice}
    Should Be Equal    ${invoiceIsSelected}    ${FALSE}
    ${queryResultInvNo}=    DB_Execute_Scalar    ${expectedBills_SQL} AND (Bills.IsComplete = 1) AND (Bills.IsProcessed = 0)
    Click Element    ${chkShowOnlyOpenBills}
    Wait until Page is unfreezed
    ${InvoiceID}    Get InvoiceID    ${listInvoice}    $invoiceNumber    ${queryResultInvNo}
    ${selectInvoice}=    Check Invoice is selectable    ${InvoiceID}
    Run Keyword If    ${selectInvoice}    Select InvoiceID    ${InvoiceID}
    Run Keyword If    ${selectInvoice}    Element Text Should Be    ${InvoiceID}/$status    &{Dic_IsComplete}[${langunge_code}]
    Check CheckboxId    ${chkShowOnlyOpenBills}    enabled=true    selected=true
    Check CheckboxId    ${chkShowProcessedBills}    enabled=true    selected=false
    Check CheckboxId    ${chkShowProformaBills}    enabled=true    selected=false
    Check CheckboxId    ${chkPrintLogo}    enabled=true    selected=false
    Check CheckboxId    ${chkAddCopy}    enabled=true    selected=false
    Check ElementId    ${btnThirdParty}    enabled=${selectInvoice}
    Check ElementId    ${btnProForma}    enabled=${selectInvoice}
    Check ElementId    ${btnAbort}    enabled=true

Select Processed Invoice DBConnection
    [Documentation]    BILL -> Rechnungsausgabe: Status der Buttons, wenn Rechnung selektiert ist im Status "Verarbeitet"
    ${langunge_code}=    Get selected LanguageCode
    ${invoiceIsSelected}    Check List has selection    ${listInvoice}
    Should Be Equal    ${invoiceIsSelected}    ${FALSE}
    ${queryResultInvNo}=    DB_Execute_Scalar    ${expectedBills_SQL} AND (Bills.IsComplete = 0) AND (Bills.IsProcessed = 1)
    Click Element    ${chkShowProcessedBills}
    Wait until Page is unfreezed
    ${InvoiceID}    Get InvoiceID    ${listInvoice}    $invoiceNumber    ${queryResultInvNo}
    ${selectInvoice}=    Check Invoice is selectable    ${InvoiceID}
    Run Keyword If    ${selectInvoice}    Select InvoiceID    ${InvoiceID}
    Run Keyword If    ${selectInvoice}    Element Text Should Be    ${InvoiceID}/$status    &{Dic_IsProcessed}[${langunge_code}]
    Check CheckboxId    ${chkShowOnlyOpenBills}    enabled=true    selected=false
    Check CheckboxId    ${chkShowProcessedBills}    enabled=true    selected=true
    Check CheckboxId    ${chkShowProformaBills}    enabled=true    selected=false
    Check CheckboxId    ${chkPrintLogo}    enabled=true    selected=false
    Check CheckboxId    ${chkAddCopy}    enabled=true    selected=false
    Check ElementId    ${btnThirdParty}    enabled=false
    Check ElementId    ${btnProForma}    enabled=false
    Check ElementId    ${btnAbort}    enabled=true

Select Processed Closed Invoice DBConnection
    [Documentation]    BILL -> Rechnungsausgabe: Status der Buttons, wenn Rechnung selektiert ist im Status "Verarbeitet & veröffentlicht"
    ${langunge_code}=    Get selected LanguageCode
    ${invoiceIsSelected}    Check List has selection    ${listInvoice}
    Should Be Equal    ${invoiceIsSelected}    ${FALSE}
    ${queryResultInvNo}=    DB_Execute_Scalar    ${expectedBills_SQL} AND (Bills.IsComplete = 1) AND (Bills.IsProcessed = 1) AND (Bills.IsProformaInvoice = 0)
    Click Element    ${chkShowProcessedBills}
    Wait until Page is unfreezed
    ${InvoiceID}    Get InvoiceID    ${listInvoice}    $invoiceNumber    ${queryResultInvNo}
    ${selectInvoice}=    Check Invoice is selectable    ${InvoiceID}
    Run Keyword If    ${selectInvoice}    Select InvoiceID    ${InvoiceID}
    Run Keyword If    ${selectInvoice}    Element Text Should Be    ${InvoiceID}/$status    &{Dic_IsCompleteAndProcessed}[${langunge_code}]
    Check CheckboxId    ${chkShowOnlyOpenBills}    enabled=true    selected=false
    Check CheckboxId    ${chkShowProcessedBills}    enabled=true    selected=true
    Check CheckboxId    ${chkShowProformaBills}    enabled=true    selected=false
    Check CheckboxId    ${chkPrintLogo}    enabled=true    selected=false
    Check CheckboxId    ${chkAddCopy}    enabled=true    selected=false
    Check ElementId    ${btnThirdParty}    enabled=false
    Check ElementId    ${btnProForma}    enabled=false
    Check ElementId    ${btnAbort}    enabled=true

Select Proforma Invoice DBConnection
    [Documentation]    BILL -> Rechnungsausgabe: Status der Buttons, wenn auch Profomarechnung anzeigen selektiert ist
    ${langunge_code}=    Get selected LanguageCode
    ${invoiceIsSelected}    Check List has selection    ${listInvoice}
    Should Be Equal    ${invoiceIsSelected}    ${FALSE}
    ${queryResultInvNo}=    DB_Execute_Scalar    ${expectedBills_SQL} AND (Bills.IsComplete = 0) AND (Bills.IsProcessed = 0) AND (Bills.IsProformaInvoice = 1)
    Click Element    ${chkShowProformaBills}
    Wait until Page is unfreezed
    ${InvoiceID}    Get InvoiceID    ${listInvoice}    $invoiceNumber    ${queryResultInvNo}
    ${selectInvoice}=    Check Invoice is selectable    ${InvoiceID}
    Run Keyword If    ${selectInvoice}    Select InvoiceID    ${InvoiceID}
    Run Keyword If    ${selectInvoice}    Element Text Should Be    ${InvoiceID}/$status    &{Dic_IsOpen}[${langunge_code}]
    Check CheckboxId    ${chkShowOnlyOpenBills}    enabled=true    selected=false
    Check CheckboxId    ${chkShowProcessedBills}    enabled=true    selected=false
    Check CheckboxId    ${chkShowProformaBills}    enabled=true    selected=true
    Check CheckboxId    ${chkPrintLogo}    enabled=true    selected=false
    Check CheckboxId    ${chkAddCopy}    enabled=true    selected=false
    Check ElementId    ${btnThirdParty}    enabled=${selectInvoice}
    Check ElementId    ${btnProForma}    enabled=${selectInvoice}
    Check ElementId    ${btnAbort}    enabled=true

Click Logo mit aufdrucken
    ${passed} =    Run Keyword And Return Status    Click Button    ${chkPrintLogo}
    Should Be Equal    ${passed}    ${TRUE}

Click Kopie anfuegen
    ${passed}    Run Keyword And Return Status    Click Button    ${chkAddCopy}
    Should Be Equal    ${passed}    ${TRUE}

Click Button Rechnung an Dritte DBConnection
    ${queryResultInvNo}=    DB_Execute_Scalar    ${expectedBills_SQL} AND (Bills.IsComplete = 0) AND (Bills.IsProcessed = 0)
    ${InvoiceID}    Get InvoiceID    ${listInvoice}    $invoiceNumber    ${queryResultInvNo}
    Select InvoiceID    ${InvoiceID}
    ${passed} =    Run Keyword And Return Status    Click Button    ${btnThirdParty}
    Wait until Page is unfreezed
    Should Be Equal    ${passed}    ${TRUE}
    ${passed} =    Run Keyword And Return Status    Check PageArea is visible    /$flow_main/$popover0    screen look_rlx_screen_alert    visible=true
    Run Keyword If    ${passed}    Click Element    /$flow_main/$popover0/btn
    Wait until Page is unfreezed

Click Button Proformarechnung DBConnection
    ${queryResultInvNo}=    DB_Execute_Scalar    ${expectedBills_SQL} AND (Bills.IsComplete = 0) AND (Bills.IsProcessed = 0)
    ${InvoiceID}    Get InvoiceID    ${listInvoice}    $invoiceNumber    ${queryResultInvNo}
    Select InvoiceID    ${InvoiceID}
    ${passed} =    Run Keyword And Return Status    Click Button    ${btnProForma}
    Wait until Page is unfreezed
    Should Be Equal    ${passed}    ${TRUE}
    ${passed} =    Run Keyword And Return Status    Check PageArea is visible    /$flow_main/$popover0    screen look_rlx_screen_alert    visible=true
    Run Keyword If    ${passed}    Click Element    /$flow_main/$popover0/btn
    Wait until Page is unfreezed
