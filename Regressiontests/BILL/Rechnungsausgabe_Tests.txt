*** Settings ***
Suite Setup       Login Select Bill
Suite Teardown    Close Browser
Resource          ../../UserKeywords/Common_Resources.html
Resource          ../../UserKeywords/BILL_Resources.html
Resource          PageObjects/Menu.txt
Resource          PageObjects/Rechnungsausgabe.txt
Variables         PageObjects/Rechnungsausgabe.yaml
Library           DatabaseLibrary
Library           ../../Libs/DatabaseClass.py    database=${DATABASE_NAME}    user=${DATABASE_USER}    password=${DATABASE_PWD}    host=${DATABASE_IP}    port=${DATABASE_PORT}

*** Test Cases ***
Check GUI Elements Rechnungsausgabe
    [Documentation]    MM 22.03.2018, Check GUI Elements for Rechnugsausgabe
    [Tags]    Bill    Rechnungsausgabe
    Select Rechnungsausgabe
    ${langunge_code}=    Get selected LanguageCode
    #title
    Check ContainsText    &{Dic_Title}[${langunge_code}]
    #grid
    Check ElementId    ${colInvoiceNumber}    &{Dic_colInvoiceNumber}[${langunge_code}]    enabled=true
    Check ElementId    ${colDescription}    &{Dic_colDescription}[${langunge_code}]    enabled=true
    Check ElementId    ${colStatus}    &{Dic_colStatus}[${langunge_code}]    enabled=true
    Check ElementId    ${colCreationDate}    &{Dic_colCreationDate}[${langunge_code}]    enabled=true
    Check ElementId    ${colItems}    &{Dic_colItems}[${langunge_code}]    enabled=true
    #checkbox
    Check CheckboxId    ${chkShowOnlyOpenBills}    &{Dic_chkShowOnlyOpenBills}[${langunge_code}]    enabled=true    selected=false
    Check CheckboxId    ${chkShowProcessedBills}    &{Dic_chkShowProcessedBills}[${langunge_code}]    enabled=true    selected=false
    Check CheckboxId    ${chkShowProformaBills}    &{Dic_chkShowProformaBills}[${langunge_code}]    enabled=true    selected=false
    Check CheckboxId    ${chkPrintLogo}    &{Dic_chkPrintLogo}[${langunge_code}]    enabled=true    selected=false
    Check CheckboxId    ${chkAddCopy}    &{Dic_chkAddCopy}[${langunge_code}]    enabled=true    selected=false
    #textfield
    Check TextfieldId    ${txtEmail}    support@rigilog.com    enabled=true    labeltext=&{Dic_txtEmail}[${langunge_code}]
    #buttons
    Check ElementId    ${btnThirdParty}    &{Dic_btnThirdParty}[${langunge_code}]    enabled=false
    Check ElementId    ${btnProForma}    &{Dic_btnProForma}[${langunge_code}]    enabled=false
    Check ElementId    ${btnAbort}    &{Dic_btnAbort}[${langunge_code}]    enabled=true
    Click Element    ${listInvoice}/0
    Check List ElementId is selected    ${listInvoice}/0    sel
    Check List ElementId is selected    ${listInvoice}/1    sel    selected=false
    Click Button    ${btnAbort}
    Check PageArea is visible    ${menu_content}    ${invoice_issue_class}    visible=false
    Check Homescreen is selected

Check Text Languagedependent
    Select Rechnungsausgabe
    Sleep    1s
    : FOR    ${key}    IN    @{AVAILABLE_LANGUAGES.keys()}
    \    Set LanguageId    ${key}
    \    Sleep    1s
    \    Check LanguageId is selected    ${key}
    \    ${langunge_code}=    Get selected LanguageCode
    \    Check ContainsText    &{Dic_Title}[${langunge_code}]
    \    Element Text Should Be    ${colInvoiceNumber}    &{Dic_colInvoiceNumber}[${langunge_code}]
    \    Element Text Should Be    ${colDescription}    &{Dic_colDescription}[${langunge_code}]
    \    Element Text Should Be    ${colStatus}    &{Dic_colStatus}[${langunge_code}]
    \    Element Text Should Be    ${colCreationDate}    &{Dic_colCreationDate}[${langunge_code}]
    \    Element Text Should Be    ${colItems}    &{Dic_colItems}[${langunge_code}]
    \    Check LabelText    ${chkShowOnlyOpenBills}    &{Dic_chkShowOnlyOpenBills}[${langunge_code}]
    \    Check LabelText    ${chkShowProcessedBills}    &{Dic_chkShowProcessedBills}[${langunge_code}]
    \    Check LabelText    ${chkShowProformaBills}    &{Dic_chkShowProformaBills}[${langunge_code}]
    \    Check LabelText    ${chkPrintLogo}    &{Dic_chkPrintLogo}[${langunge_code}]
    \    Check LabelText    ${chkAddCopy}    &{Dic_chkAddCopy}[${langunge_code}]
    \    Check ContainsText    &{Dic_txtEmail}[${langunge_code}]
    \    Element Text Should Be    ${btnThirdParty}    &{Dic_btnThirdParty}[${langunge_code}]
    \    Element Text Should Be    ${btnProForma}    &{Dic_btnProForma}[${langunge_code}]
    \    Element Text Should Be    ${btnAbort}    &{Dic_btnAbort}[${langunge_code}]

No Invoice Selected
    [Documentation]    BILL -> Rechnungsausgabe: Status der Buttons, wenn kein Element selektiert ist
    Select Rechnungsausgabe
    ${invoiceIsSelected}    Check List has selection    ${listInvoice}
    Should Be Equal    ${invoiceIsSelected}    ${FALSE}
    Check CheckboxId    ${chkShowOnlyOpenBills}    enabled=true    selected=false
    Check CheckboxId    ${chkShowProcessedBills}    enabled=true    selected=false
    Check CheckboxId    ${chkShowProformaBills}    enabled=true    selected=false
    Check CheckboxId    ${chkPrintLogo}    enabled=true    selected=false
    Check CheckboxId    ${chkAddCopy}    enabled=true    selected=false
    Check ElementId    ${btnThirdParty}    enabled=false
    Check ElementId    ${btnProForma}    enabled=false
    Check ElementId    ${btnAbort}    enabled=true

Open Invoice Selected
    [Documentation]    BILL -> Rechnungsausgabe: Status der Buttons, wenn Rechnung selektiert ist im Status "In Bearbeitung"
    Select Rechnungsausgabe
    ${invoiceIsSelected}    Check List has selection    ${listInvoice}
    Should Be Equal    ${invoiceIsSelected}    ${FALSE}
    ${queryResultInvNo}=    DB_Execute_Scalar    ${expectedBills_SQL} AND (Bills.IsComplete = 0) AND (Bills.IsProcessed = 0)
    Click Element    ${chkShowOnlyOpenBills}
    Wait until Page is freezed
    #Log To Console    Open InvoiceNo-->${queryResultInvNo}
    ${listInvoiceID}    Get ElementID from List    ${listInvoice}    $invoiceNumber    ${queryResultInvNo}
    Click Element    ${listInvoiceID}
    Check List ElementId is selected    ${listInvoiceID}    sel
    Element Text Should Be    ${listInvoiceID}/$status    In Bearbeitung
    Check CheckboxId    ${chkShowOnlyOpenBills}    enabled=true    selected=true
    Check CheckboxId    ${chkShowProcessedBills}    enabled=true    selected=false
    Check CheckboxId    ${chkShowProformaBills}    enabled=true    selected=false
    Check CheckboxId    ${chkPrintLogo}    enabled=true    selected=false
    Check CheckboxId    ${chkAddCopy}    enabled=true    selected=false
    Check ElementId    ${btnThirdParty}    enabled=true
    Check ElementId    ${btnProForma}    enabled=true
    Check ElementId    ${btnAbort}    enabled=true

Processed Invoice Selected
    [Documentation]    BILL -> Rechnungsausgabe: Status der Buttons, wenn Rechnung selektiert ist im Status "Verarbeitet"
    Select Rechnungsausgabe
    ${invoiceIsSelected}    Check List has selection    ${listInvoice}
    Should Be Equal    ${invoiceIsSelected}    ${FALSE}
    ${queryResultInvNo}=    DB_Execute_Scalar    ${expectedBills_SQL} AND (Bills.IsComplete = 0) AND (Bills.IsProcessed = 1)
    Log To Console    Processed InvoiceNo-->${queryResultInvNo}
    ${listInvoiceID}    Get ElementID from List    ${listInvoice}    $invoiceNumber    ${queryResultInvNo}
    Click Element    ${listInvoiceID}
    Check List ElementId is selected    ${listInvoiceID}    sel
    Element Text Should Be    ${listInvoiceID}/$status${invProcessed}    Verarbeitet
    Check CheckboxId    ${chkShowOnlyOpenBills}    enabled=true    selected=true
    Check CheckboxId    ${chkShowProcessedBills}    enabled=true    selected=false
    Check CheckboxId    ${chkShowProformaBills}    enabled=true    selected=false
    Check CheckboxId    ${chkPrintLogo}    enabled=true    selected=false
    Check CheckboxId    ${chkAddCopy}    enabled=true    selected=false
    Check ElementId    ${btnThirdParty}    enabled=false
    Check ElementId    ${btnProForma}    enabled=false
    Check ElementId    ${btnAbort}    enabled=true

Processed Closed Invoice Selected
    [Documentation]    BILL -> Rechnungsausgabe: Status der Buttons, wenn Rechnung selektiert ist im Status "Verarbeitet"
    Select Rechnungsausgabe
    ${invoiceIsSelected}    Check List has selection    ${listInvoice}
    Should Be Equal    ${invoiceIsSelected}    ${FALSE}
    ${queryResultInvNo}=    DB_Execute_Scalar    ${expectedBills_SQL} AND (Bills.IsComplete = 1) AND (Bills.IsProcessed = 1) AND (Bills.IsProformaInvoice = 0)
    Log To Console    Processed Closed InvoiceNo-->${queryResultInvNo}
    ${listInvoiceID}    Get ElementID from List    ${listInvoice}    $invoiceNumber    ${queryResultInvNo}
    Click Element    ${listInvoiceID}
    Check List ElementId is selected    ${listInvoiceID}    sel
    Element Text Should Be    ${listInvoiceID}/$status${invProcessedClosed}    Verarbeitet & veröffentlicht
    Check CheckboxId    ${chkShowOnlyOpenBills}    enabled=true    selected=false
    Check CheckboxId    ${chkShowProcessedBills}    enabled=true    selected=true
    Check CheckboxId    ${chkShowProformaBills}    enabled=true    selected=false
    Check CheckboxId    ${chkPrintLogo}    enabled=true    selected=false
    Check CheckboxId    ${chkAddCopy}    enabled=true    selected=false
    Check ElementId    ${btnThirdParty}    enabled=false
    Check ElementId    ${btnProForma}    enabled=false
    Check ElementId    ${btnAbort}    enabled=true

Proforma Invoice Selected
    [Documentation]    BILL -> Rechnungsausgabe: Status der Buttons, wenn Rechnung selektiert ist im Status "Verarbeitet"
    Select Rechnungsausgabe
    ${invoiceIsSelected}    Check List has selection    ${listInvoice}
    Should Be Equal    ${invoiceIsSelected}    ${FALSE}
    ${queryResultInvNo}=    DB_Execute_Scalar    ${expectedBills_SQL} AND (Bills.IsComplete = 1) AND (Bills.IsProcessed = 0) AND (Bills.IsProformaInvoice = 1)
    Log To Console    Proforma InvoiceNo-->${queryResultInvNo}
    ${listInvoiceID}    Get ElementID from List    ${listInvoice}    $invoiceNumber    ${queryResultInvNo}
    Click Element    ${listInvoiceID}
    Check List ElementId is selected    ${listInvoiceID}    sel
    Element Text Should Be    ${listInvoiceID}/$status${invProcessedClosed}    Verarbeitet & veröffentlicht
    Check CheckboxId    ${chkShowOnlyOpenBills}    enabled=true    selected=false
    Check CheckboxId    ${chkShowProcessedBills}    enabled=true    selected=true
    Check CheckboxId    ${chkShowProformaBills}    enabled=true    selected=false
    Check CheckboxId    ${chkPrintLogo}    enabled=true    selected=false
    Check CheckboxId    ${chkAddCopy}    enabled=true    selected=false
    Check ElementId    ${btnThirdParty}    enabled=false
    Check ElementId    ${btnProForma}    enabled=false
    Check ElementId    ${btnAbort}    enabled=true
