*** Settings ***
Library           ../../../Libs/DatabaseClass.py    database=${DATABASE_NAME}    user=${DATABASE_USER}    password=${DATABASE_PWD}    host=${DATABASE_IP}    port=${DATABASE_PORT}
Library           ../../../Libs/SQLQueryReader.py

*** Variables ***
# ~~~~~~~~~ checkboxes
${chkShowOnlyOpenBills}    /$flow_main/$flow_content/ShowOnlyOpenBills
${chkShowProcessedBills}    /$flow_main/$flow_content/ShowProcessedBills
${chkShowProformaBills}    /$flow_main/$flow_content/ShowProformaBills
${chkPrintLogo}    /$flow_main/$flow_content/Print_Logo
${chkAddCopy}     /$flow_main/$flow_content/cbx_AddCopy
# ~~~~~~~~~ textfield
${txtEmail}       /$flow_main/$flow_content/email
# ~~~~~~~ buttons
${btnCreateBill}    /$flow_main/$flow_content/createBill
${btnAbort}       /$flow_main/$flow_content/abort
${btnThirdParty}    /$flow_main/$flow_content/thirdParty
${btnProForma}    /$flow_main/$flow_content/proForma
# ~~~~~~~ invoices list
${listInvoice}    /$flow_main/$flow_content/issue_list
# ~~~~~~~ invoices col
${colInvoiceNumber}    ${listInvoice}/$col_invoiceNumber
${colDescription}    ${listInvoice}/$col_description
${colStatus}      ${listInvoice}/$col_status
${colCreationDate}    ${listInvoice}/$col_creationDate
${colItems}       ${listInvoice}/$col_items

*** Keywords ***
Get InvoiceID
    [Arguments]    ${Id}    ${Col}    ${Value}=${EMPTY}
    ${Value}=    Get Stripped String    ${Value}
    Run Keyword If    '${Value}' == '${EMPTY}'    Log    Es konnte keine entsprechende Rechnung gefunden werden!    WARN
    ${ElementId}    Get ElementID from List    ${Id}    ${Col}    ${Value}
    Run Keyword If    '${Value}' != '${EMPTY}' and '${ElementId}' == '${EMPTY}'    Fail    Die Rechnung (${Value}) konnte nicht gefunden werden!
    [Return]    ${ElementId}

Check Invoice is selectable
    [Arguments]    ${Id}
    ${selectInvoice}=    Set Variable if    '${Id}'=='${EMPTY}'    ${FALSE}    ${TRUE}
    Run Keyword If    '${selectInvoice}' == '${TRUE}'    Log    Eine entsprechende Rechnung wurde gefunden und kann ausgewählt werden    INFO
    Run Keyword If    '${selectInvoice}' == '${FALSE}'    Log    Eine entsprechende Rechnung wurde nicht gefunden und kann auch nicht ausgewählt werden    WARN
    [Return]    ${selectInvoice}

Select InvoiceID
    [Arguments]    ${Id}
    Click Element And Wait    ${Id}
    Check List ElementId is selected    ${Id}    sel

Get InvoiceID with Positions
    [Arguments]    ${element_id}    ${endRange}=999999
    : FOR    ${index}    IN RANGE    ${endRange}
    \    ${passed} =    Run Keyword And Return Status    Element Should Be Visible    ${element_id}/${index}
    \    Return From Keyword If    '${passed}'!='${TRUE}'    ${EMPTY}
    \    ${colValue} =    Get Text    ${element_id}/${index}/$items
    \    Return From Keyword If    '${colValue}'>'0'    ${element_id}/${index}
    [Return]    ${EMPTY}

Get InvoiceNo From Database
    [Arguments]    ${query_name}
    ${sql} =    SQLQueryReader.Get Query By Name    ${SQL_QUERIES_PATH}/BILL/SQLQueries.resx    ${query_name}
    ${queryResult}=    DatabaseClass.DB Execute Scalar With Parameter    ${sql}    ${DEFAULT_MANDATOR_NAME}
    [Return]    ${queryResult}

Teardown Rechnungsausgabe
    ${passed} =    Run Keyword And Return Status    Select Rechnungsausgabe
    Return From Keyword If    ${passed}
    Log    Die Seite war nicht clickable daher muss der Browser geschlossen und neugestartet werden    WARN
    Close Browser
    Select Rechnungsausgabe    true
