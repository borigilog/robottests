*** Settings ***
Resource          ../UserKeywords/LOG_Resources.html
Library           Selenium2Library
Library           DatabaseLibrary
Library           ../Libs/DatabaseClass.py    database=${DATABASE_NAME}    user=${DATABASE_USER}    password=${DATABASE_PWD}    host=${DATABASE_IP}    port=${DATABASE_PORT}

*** Test Cases ***
Login to new Website
    Open Browser    ${RLX_LOGIN_URL}    ${BROWSER}
    Wait Until Page Contains Element    //input[contains(@id, 'login_username')]
    Page Should Contain Element    //input[contains(@id,'login_password')]
    Input Text    //input[contains(@id, 'login_username')]    ${RLX_USER}
    Input Text    //input[contains(@id,'login_password')]    ${RLX_PWD}
    Click Element    //button//div[contains(text(), '${RLX_LOGIN_BUTTON_TEXT}')]
    Wait Until Page Contains Element    //div[contains(text(), 'Mandantenauswahl')]
    #[Teardown]    Close Browser

Check Mandators
    Login to RLX Website
    Check available Mandators    Hauptmandant
    Check available Mandators    Submandant1
    Check available Mandators    Submandant2
    Select Mandator    Hauptmandant
    [Teardown]    Close Browser

Check OAC Main Page
    Login to RLX Website
    Select Mandator    Hauptmandant
    Wait Until Page Contains Element    //select[contains(@id, 'modules')]
    Element Text Should Be    //select[contains(@id, 'modules')]/option[@value=0]    OAC
    Page Should Contain Element    //select[contains(@id, 'modules')]/option[contains(text(), 'OAC')]
    [Teardown]    Close Browser

Check PSTB Employee
    Login to RLX Website
    Select Mandator    Hauptmandant
    Select Module Website    OAC
    Select SubMenue    Nachbestellung/Ersatz    FÃ¼r Mitarbeiter
    Wait Until Element Is Visible    //*[@id="/$flow_main/$flow_content/person_name"]
    Click Element    //*[@id="/$flow_main/$flow_content/person_name"]
    Input Text    //*[@id="/$flow_main/$flow_content/person_name"]    Ackermann
    Click Element    //*[@id="/$flow_main/$flow_content/search_user"]
    Wait Until Element Is Visible    //*[@id="/$flow_main/$flow_content/count"]
    ${AnzahlSuchergebnisse}=    Get Matching Xpath Count    //td[@data-colindex="1"]/div[contains(@id,'/$n')]
    ${AnzahlSuchergebnisse}=    Convert To Integer    ${AnzahlSuchergebnisse}
    Run Keyword If    ${AnzahlSuchergebnisse}==0    Fail    No entry for specified businesspartner found
    Click Element    //*[@id="/$flow_main/$flow_content/back"]
    Wait Until Page Contains Element    //*[@id="/$flow_main/$flow_content/person_name"]
    Click Element    //*[@id="/$flow_main/menu_bottom/exit"]
    [Teardown]    Close Browser

Connect To Database
    [Documentation]    pip install -U robotframework-databaselibrary
    ...    https://franz-see.github.io/Robotframework-Database-Library/api/0.5/DatabaseLibrary.html
    ...    pip install pymssql
    ...    http://www.pymssql.org/en/stable/
    Open Browser    ${RLX_LOGIN_URL}    ${BROWSER}
    Connect To Database Using Custom Params    pymssql    database='${DATABASE_NAME}', user='${DATABASE_USER}', password='${DATABASE_PWD}', host='${DATABASE_IP}', port='${DATABASE_PORT}'
    Check If Exists In Database    select * from Concerns where Concerns.ConcernID = '75d28447-b0b7-4196-9c40-6417e614f836'
    @{queryConcernResults1}=    Query    select ConcernID, IsDeleted, DateOfCreation from Concerns
    Log To Console    Result1:@{queryConcernResults1}
    @{queryConcernResults2}=    DB_Execute_Querry    select * from Concerns where Concerns.ConcernID = '75d28447-b0b7-4196-9c40-6417e614f836'
    Log To Console    Result2:@{queryConcernResults2}
    ${queryConcernResults3}=    DB_Execute_Scalar    select Count(*) from Concerns where Concerns.ConcernID = '75d28447-b0b7-4196-9c40-6417e614f836'
    Log To Console    Result3:${queryConcernResults3}
    [Teardown]    Close Browser
